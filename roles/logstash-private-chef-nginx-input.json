{
  "name": "logstash-private-chef-nginx-input",
  "description": "Input handler for the private chef fe nginx logs.",
  "json_class": "Chef::Role",
  "default_attributes": {
    "logstash": {
      "inputs": {
        "private-chef-nginx": {
          "port": 5670,
          "query": {
            "role": "logstash_elasticsearch_master",
            "tags": "private-chef-nginx",
            "chef_environment": "prod"
          },
          "filters": {
            "grok": {
              "type": "private-chef-nginx",
              "pattern": "%{IP:clientip} %{DATA:ident} %{DATA:remote_user} \\[%{HTTPDATE:timestamp}\\]  \\\"(?:%{WORD:verb} %{NOTSPACE:request}(?: HTTP/%{DATA:httpversion})?|-)\\\" %{INT:status} \\\"%{DATA:request_time}\\\" %{INT:body_bytes_sent} \\\"%{DATA:referer}\\\" \\\"%{DATA:user_agent}\\\" \\\"%{IP:upstream_addr}:%{INT:upstream_port}\\\" \\\"%{INT:upstream_status}\\\" \\\"%{DATA:upstream_response_time}\\\" \\\"%{DATA:chef_version}\\\" \\\"%{DATA:http_x_ops_sign}\\\" \\\"%{DATA:http_x_ops_userid}\\\" \\\"%{TIMESTAMP_ISO8601:http_x_ops_timestamp}\\\" \\\"%{DATA:http_x_ops_content_hash}\\\" %{INT:request_length}"
            },
            "mutate": {
              "type": "private-chef-nginx",
              "replace": [
                "@timestamp",
                "%{@fields.http_x_ops_timestamp}"
              ]
            },
            "grep": {
              "type": "private-chef-nginx",
              "tags": [
                "_grokparsefailure"
              ],
              "negate": true
            }
          }
        }
      }
    }
  },
  "override_attributes": {
  },
  "chef_type": "role",
  "run_list": [
    "role[pan]",
    "role[crust]",
    "role[filling]",
    "recipe[logstash::server]",
    "recipe[log_pie::custom_input]",
    "role[topping]"
  ],
  "env_run_lists": {
  }
}
